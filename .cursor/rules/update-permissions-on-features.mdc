---
description: При появлении новых фич или изменении флоу обновлять Право / Роль (Permission и Role–Permission)
alwaysApply: true
---

# Обновление прав и ролей при новых фичах

**При добавлении новых фич или изменении пользовательского флоу обязательно обновлять систему Право / Роль.**

## Что обновлять

1. **Backend: Permission и RolePermission**
   - Добавить новое разрешение в миграцию (data migration) или в seed: модель `users.Permission` (code, name, resource, action).
   - Назначить разрешение ролям через `users.RolePermission` (роль + permission).
   - Файлы: `backend/users/migrations/` — новая data migration по образцу `0003_seed_permissions.py`, либо расширить существующий seed при первичной настройке.

2. **Документация: бизнес-логика**
   - Обновить таблицу «Роли и разрешения» в `.cursor/business-logic.md`: новая строка разрешения и галочки по ролям.
   - При новом пункте меню — добавить строку в таблицу «Навигация (Frontend, сайдбар)» с ролями и кодом разрешения (например `nav.xxx`).

3. **Frontend: навигация и проверки**
   - При новом разделе/странице: добавить пункт в `widgets/sidebar/Sidebar.tsx` и `widgets/bottom-nav/BottomNav.tsx` с `requiredPermissions: ['nav.xxx']` и/или `roles: [...]`.
   - Код разрешения для навигации должен совпадать с кодом в Permission (например `nav.school_settings`).

4. **Backend: проверка доступа**
   - Для viewset’ов: использовать `HasPermission('resource.action')` при необходимости гранулярной проверки по матрице разрешений.
   - Либо оставить проверку по роли (IsSchoolAdmin, IsTeacher и т.д.), если новый функционал входит в существующую роль и не требует отдельного переключаемого права.

## Пример

Добавили фичу «Классы в настройках школы» (CRUD классов):
- Добавить разрешение `classes.crud` («CRUD классов в школе»), назначить ролям superadmin, schooladmin, director.
- В business-logic.md — строка «Классы (CRUD в школе)» с галочками по ролям.
- Доступ к странице «Настройки школы» и «Карточка школы» уже даёт таб «Классы»; при необходимости отдельного пункта меню — добавить `nav.xxx` и пункт в сайдбар.
